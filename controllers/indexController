const db = require("../db/queries");
const bcrypt = require("bcryptjs");


//print all comment to board
async function getComments(req, res) {
  try {
  const messages = await db.returnAllComments2();
  console.log("Messages: ", messages);
  res.render('index', { messages, user: req.user });
  
  } catch (error) {
    console.error('Error in getComments:', error);
    res.status(500).send('Error fetching comments')
  }
}

//add new user
async function signupUser(req, res) {
  const password = await bcrypt.hash(req.body.password, 10);
  const { first, last, username } = req.body;
  console.log('success', first, last, username, password);
  try {
    await db.addUser(first, last, username, password);
    console.log("Successfully inserted username into DB")
    res.redirect("/");
  } catch (error) {
    console.error("DB error", error);
    res.status(500).send("Error Saving user.") }  
}

module.exports = {
    getComments,
    signupUser,
}