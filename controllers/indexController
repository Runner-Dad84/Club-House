const db = require("../db/queries");
const bcrypt = require("bcryptjs");


//print all comment to board
async function getComments(req, res) {
  try {
  const messages = await db.returnAllComments2();
  console.log("Messages: ", messages);
  res.render('index', { messages, user: req.user });
  
  } catch (error) {
    console.error('Error in getComments:', error);
    res.status(500).send('Error fetching comments')
  }
}

//add new user
async function signupUser(req, res) {
  const password = await bcrypt.hash(req.body.password, 10);
  const { first, last, username, userInput} = req.body;
  console.log('success', first, last, username, password, userInput);
  try {
    await db.addUser2(first, last, username, password, userInput);
    console.log("Successfully inserted username into DB")
    res.redirect("/");
  } catch (error) {
    console.error("DB error", error);
    res.status(500).send("Error Saving user.") }  
}

//add new comment

async function addMessage(req, res) {
  const msg_id = req.user.member_id;
 console.log("Logged-in user:", req.user);
  const { message } = req.body;
  try {
    await db.insertMessage(message, msg_id);
    console.log('New message posted.')
    res.redirect("/");
  } catch (error) {
    console.log(message, msg_id)
    res.status(500).send("Error adding comment.") } 
}

module.exports = {
    getComments,
    signupUser,
    addMessage
}